# ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡Ğ½Ğ° Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ° â„–4 - Telegram Ğ±Ğ¾Ñ‚

## Ğ¢ĞµĞ¼Ğ° Ñ– Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ

Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Telegram Ğ±Ğ¾Ñ‚Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ñƒ Ñ‚Ğ° Ğ¿Ğ¾ÑˆÑƒĞºÑƒ Ğ°Ğ²Ñ‚Ğ¾.

## Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ğ²ĞµÑ†ÑŒ

Ğ›ÑĞ±Ñ‡ĞµĞ½ĞºĞ¾ ĞĞ»ĞµĞ³

## Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ

### Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ğ±Ğ¾Ñ‚Ñƒ

Ğ ĞµÑ”ÑÑ‚Ñ€ÑƒÑ”Ğ¼Ğ¾ Ğ±Ğ¾Ñ‚Ğ° Ñ‚Ğ° Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ”Ğ¼Ğ¾ Ñ‚Ğ¾ĞºĞµĞ½.
![1718114392032](image/Ğ—Ğ²Ñ–Ñ‚/1718114392032.png)

Ğ’Ğ¸ĞºĞ¾Ğ½ÑƒÑ”Ğ¼Ğ¾ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ±Ğ¾Ñ‚Ñƒ.
![1718114412609](image/Ğ—Ğ²Ñ–Ñ‚/1718114412609.png)

### ĞšĞ¾Ğ´ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¸
Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ”Ğ¼Ğ¾ Ñ„Ğ°Ğ¹Ğ» bot.py Ñ‚Ğ° Ğ¿Ğ¸ÑˆĞµĞ¼Ğ¾ ĞºĞ¾Ğ´ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¸.
```python
import telebot
import config
import bot_token
import requests
import time
from lxml import html
from telebot import types
from telebot.types import InputMediaPhoto, InputMediaVideo
import sqlite3
from pathlib import Path
import io, base64
from PIL import Image
import os
import shutil
import base64

Reg_User = {
    1:{'id', 'name', 'surname', 'phone', 'tag'}
}
Reg_Avto={
    1:{'user_id', 'brand', 'model', 'description', 'price'}
}
Add_photo={
    1:{'user_id', 'ad_id', 'picture'}
}
Avto={
    1:{'id', 'user_id', 'brand', 'model', 'description', 'price'}
}

conn = sqlite3.connect("./Practical-4/avto.db", check_same_thread=False)
cursor = conn.cursor()
bot = telebot.TeleBot(bot_token.TOKEN)

def get_cursor():
    conn = sqlite3.connect('./Practical-4/avto.db', check_same_thread=False)
    return conn.cursor(), conn

@bot.message_handler(commands=['start'])
def start(message):
    Reg_User[message.chat.id] = [' ', ' ', ' ', ' ', ' ']
    Reg_Avto[message.chat.id] = [' ', ' ', ' ', ' ', ' ']
    Add_photo[message.chat.id] = [' ', ' ', ' ']
    Avto[message.chat.id] = [' ', ' ', ' ', ' ', ' ', ' ']
    Reg_User[message.chat.id][0] = message.chat.id
    Reg_User[message.chat.id][4] = message.from_user.username
    Reg_Avto[message.chat.id][0] = message.chat.id
    reg = check(message.chat.id)
    if reg == 1:
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        add_ads_button = types.KeyboardButton("ğŸ†•Â  â€¢Â  Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸")
        my_ads_button = types.KeyboardButton("ğŸ”Â  â€¢Â  ĞŸĞ¾ÑˆÑƒĞº")
        view_ads_button = types.KeyboardButton("ğŸ“ƒÂ  â€¢Â  ĞœĞ¾Ñ— Ğ°Ğ²Ñ‚Ğ¾")
        markup.add(add_ads_button, view_ads_button, my_ads_button)
        message=bot.send_message(message.chat.id, "ğŸ‘‹Â  â€¢Â  Ğ›Ğ°ÑĞºĞ°Ğ²Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸Ğ¼Ğ¾ Ğ´Ğ¾ Horizon Autoshow, {0.first_name}!\n\nâœ…Â  â€¢Â  ĞĞ¸Ğ¶Ğ½Ñ” Ğ¼ĞµĞ½Ñ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ¾, Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ, Ñ‰Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚Ğµ Ğ·Ñ€Ğ¾Ğ±Ğ¸Ñ‚Ğ¸!"
        .format(message.from_user, bot.get_me()), parse_mode='html', reply_markup=markup)
        bot.register_next_step_handler(message, distribution)
    else:
        message = bot.send_message(message.chat.id, "ğŸ‘‹Â  â€¢Â  ĞĞ²Ğ²Ğ°, ÑÑ…Ğ¾Ğ¶Ğµ Ğ¼Ğ¸ Ğ½Ğµ Ğ±Ğ°Ñ‡Ğ¸Ğ»Ğ¸ÑÑ Ñ€Ğ°Ğ½Ñ–ÑˆĞµ. Ğ—Ğ°Ñ€ĞµÑ”ÑÑ‚Ñ€ÑƒÑ”Ğ¼Ğ¾ Ğ’Ğ°Ñ!\n\nâ“Â  â€¢Â  Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ²Ğ°ÑˆĞµ Ñ–Ğ¼'Ñ.")
        bot.register_next_step_handler(message, reg_login)

def check(user_id):
    cursor.execute('SELECT * FROM `user_data`')
    rows = cursor.fetchall()
    empty = 0
    for row in rows:
        if row[0] == user_id:
            empty = 1
    return empty

def check_id(ad_name, user_id):
    cursor, conn = get_cursor()
    cursor.execute('SELECT id FROM avto WHERE user_id=? AND brand=?', (user_id, ad_name))
    data = cursor.fetchone()
    cursor.close()
    conn.close()
    return data[0] if data else None

def reg_login(message):
    Reg_User[message.chat.id][1] = message.text
    message = bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ§ÑƒĞ´Ğ¾Ğ²Ğ¾, Ñ‚ĞµĞ¿ĞµÑ€ Ğ¿Ñ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ.")
    bot.register_next_step_handler(message, reg_surname)

def reg_surname(message):
    Reg_User[message.chat.id][2] = message.text
    message = bot.send_message(message.chat.id, "â“Â  â€¢Â  ĞÑƒ Ñ– Ğ½Ğ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğº Ğ²Ğ°Ñˆ Ğ½Ğ¾Ğ¼ĞµÑ€ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ñƒ, Ğ´Ğ»Ñ Ğ·Ğ²'ÑĞ·ĞºÑƒ.")
    bot.register_next_step_handler(message, reg_phone)

def reg_phone(message):
    Reg_User[message.chat.id][3] = message.text
    reg(Reg_User[message.chat.id][0], Reg_User[message.chat.id][1], Reg_User[message.chat.id][2], Reg_User[message.chat.id][3], Reg_User[message.chat.id][4])
    markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
    back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
    markup.add(back_button)
    message = bot.send_message(message.chat.id, "ğŸ‰Â  â€¢Â  Ğ ĞµÑ”ÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ Ğ·Ğ°ĞºÑ–Ğ½Ñ‡ĞµĞ½Ğ¾! Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ Ğ² Ğ¼ĞµĞ½Ñ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸.", reply_markup=markup)
    bot.register_next_step_handler(message, start)

def reg(user_id, name, surname, phone, tag):
    cursor.execute('INSERT INTO user_data (id, name, surname, phone, tag) VALUES (?, ?, ?, ?, ?)', (user_id, name, surname, phone, tag))
    conn.commit()

def distribution(message):
    if message.text == "ğŸ†•Â  â€¢Â  Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸":
        bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ¯ĞºĞ° Ğ¼Ğ°Ñ€ĞºĞ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ñ–Ğ»Ñ?")
        bot.register_next_step_handler(message, create_model)
    elif message.text == "ğŸ”Â  â€¢Â  ĞŸĞ¾ÑˆÑƒĞº":
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        find_button = types.KeyboardButton("ğŸ·ï¸Â  â€¢Â  Ğ—Ğ° Ğ¼Ğ°Ñ€ĞºĞ¾Ñ")
        all_button = types.KeyboardButton("ğŸŒÂ  â€¢Â  Ğ’ÑÑ–")
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(find_button, all_button, back_button)
        bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ’Ğ¸ Ñ…Ğ¾Ñ‡ĞµÑ‚Ğµ Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ½ÑƒÑ‚Ğ¸ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ğ·Ğ° Ğ¿ĞµĞ²Ğ½Ğ¾Ñ Ğ¼Ğ°Ñ€ĞºĞ¾Ñ, Ñ‡Ğ¸ Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ğ¾ Ğ²ÑÑ–?", reply_markup=markup)
        bot.register_next_step_handler(message, view_distribution)
    elif message.text == "ğŸ“ƒÂ  â€¢Â  ĞœĞ¾Ñ— Ğ°Ğ²Ñ‚Ğ¾":
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        edit = types.KeyboardButton("ğŸ“Â  â€¢Â  Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸")
        delete = types.KeyboardButton("ğŸ—‘ï¸Â  â€¢Â  Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸")
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(edit, delete, back_button)
        bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ¯ĞºÑƒ Ğ´Ñ–Ñ Ğ²Ğ¸ Ñ…Ğ¾Ñ‡ĞµÑ‚Ğµ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ñ‚Ğ¸ Ğ·Ñ– ÑĞ²Ğ¾Ñ—Ğ¼ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½ÑĞ¼?", reply_markup=markup)
        bot.register_next_step_handler(message, my_ad_distribution)
    else:
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        bot.send_message(message.chat.id, "Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ Ğ² Ğ¼ĞµĞ½Ñ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸", reply_markup=markup)
        bot.register_next_step_handler(message, start)

def view_distribution(message):
    if message.text == "ğŸŒÂ  â€¢Â  Ğ’ÑÑ–":
        view_all(message.chat.id)
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "ğŸ”Â  â€¢Â ĞÑÑŒ, Ğ²ÑĞµ, Ñ‰Ğ¾ Ñ Ğ·Ğ½Ğ°Ğ¹ÑˆĞ¾Ğ², Ğ²Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚Ğ¸ ID Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ, ÑĞºĞµ Ğ²Ğ°Ñ Ğ·Ğ°Ñ†Ñ–ĞºĞ°Ğ²Ğ¸Ğ»Ğ¾ Ñ– Ñ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»Ñ Ğ¿Ñ€Ğ¾ Ñ†Ğµ Ğ²Ğ»Ğ°ÑĞ½Ğ¸ĞºĞ°.", reply_markup=markup)
        bot.register_next_step_handler(message, view_back)

    elif message.text == "ğŸ·ï¸Â  â€¢Â  Ğ—Ğ° Ğ¼Ğ°Ñ€ĞºĞ¾Ñ":
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ¯ĞºÑƒ Ğ¼Ğ°Ñ€ĞºÑƒ Ğ²Ğ¸ ÑˆÑƒĞºĞ°Ñ”Ñ‚Ğµ?", reply_markup=markup)
        bot.register_next_step_handler(message, view_find)

    else:
        send_answer(message.text, message.chat.id)
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ Ğ² Ğ¼ĞµĞ½Ñ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸", reply_markup=markup)
        bot.register_next_step_handler(message, start)

def view_find(message):
    brand = message.text
    find(message.chat.id, brand)
    markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
    back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
    markup.add(back_button)
    message = bot.send_message(message.chat.id, "ğŸ”Â  â€¢Â ĞÑÑŒ, Ğ²ÑĞµ, Ñ‰Ğ¾ Ñ Ğ·Ğ½Ğ°Ğ¹ÑˆĞ¾Ğ², Ğ²Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚Ğ¸ ID Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ, ÑĞºĞµ Ğ²Ğ°Ñ Ğ·Ğ°Ñ†Ñ–ĞºĞ°Ğ²Ğ¸Ğ»Ğ¾ Ñ– Ñ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»Ñ Ğ¿Ñ€Ğ¾ Ñ†Ğµ Ğ²Ğ»Ğ°ÑĞ½Ğ¸ĞºĞ°.", reply_markup=markup)
    bot.register_next_step_handler(message, view_back)


def view_back(message):
    if message.text == "â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸":
        start(message)  # ĞŸĞ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ Ğ² Ğ¼ĞµĞ½Ñ
    elif message.text.isdigit():
        ad_id = int(message.text)
        send_answer(ad_id, message.chat.id)
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        bot.send_message(message.chat.id, "Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ Ğ² Ğ¼ĞµĞ½Ñ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸", reply_markup=markup)
        bot.register_next_step_handler(message, start)
    else:
        bot.send_message(message.chat.id, "Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ²Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ½Ğ¾Ğ¼ĞµÑ€ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ğ°Ğ±Ğ¾ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ Ğ² Ğ¼ĞµĞ½Ñ.")
        bot.register_next_step_handler(message, view_back)

def find(user_id, brand):
    cursor.execute('SELECT * FROM avto WHERE brand = ?', (brand,))
    rows = cursor.fetchall()
    for row in rows:
        text_message = f"<strong>ğŸš˜Â  â€¢Â  {row[2]} {row[3]} (ID: {row[0]})</strong>\n\n<blockquote>{row[4]}</blockquote>\n\n"
        
        cursor.execute('SELECT * FROM photo WHERE ad_id = ?', (row[0],))
        rows_photo = cursor.fetchall()

        text_message += "ğŸ’²Â  â€¢Â  " + str(row[5]) + "CR \n\n"
        
        cursor.execute('SELECT * FROM user_data WHERE id = ?', (row[1],))
        user = cursor.fetchone()
        if user:
            text_message += f'ğŸ‘¤Â  â€¢Â  <a href="https://t.me/{user[4]}">{user[1]} {user[2]}</a>Â  â€¢Â  {user[3]}'

        photo_directory = Path(f'files/search/{user_id}')
        photo_directory.mkdir(parents=True, exist_ok=True)
        
        photos = []
        for idx, photo in enumerate(rows_photo):
            photo_path = photo_directory / f'file_{idx}.jpg'
            with open(photo_path, 'wb') as fh:
                fh.write(base64.decodebytes(photo[2].encode('utf-8')))
            photos.append(InputMediaPhoto(open(photo_path, 'rb')))
        
        if photos:
            photos[0].caption = text_message
            photos[0].parse_mode = 'HTML'
            bot.send_media_group(user_id, media=photos)
            for photo in photos:
                photo.media.close()
        else:
            bot.send_message(user_id, text=text_message, parse_mode='HTML')

        shutil.rmtree(photo_directory)

def create_model(message):
    Reg_Avto[message.chat.id][1] = message.text
    message = bot.send_message(message.chat.id, "â“Â  â€¢ Â Ğ Ñ‰Ğ¾Ğ´Ğ¾ Ğ¼Ğ¾Ğ´ĞµĞ»Ñ–?")
    bot.register_next_step_handler(message, create_description)

def create_description(message):
    Reg_Avto[message.chat.id][2] = message.text
    message = bot.send_message(message.chat.id, "â“Â  â€¢Â  ĞĞ¿Ğ¸ÑˆÑ–Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾.")
    bot.register_next_step_handler(message, create_price)

def create_price(message):
    Reg_Avto[message.chat.id][3] = message.text
    message = bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ—Ğ°Ğ·Ğ½Ğ°Ñ‡Ñ‚Ğµ Ñ†Ñ–Ğ½Ñƒ.")
    bot.register_next_step_handler(message, photo_question)

def create_avto(user_id, brand, model, description, price):
    cursor, conn = get_cursor()
    cursor.execute('INSERT INTO avto (user_id, brand, model, description, price) VALUES (?, ?, ?, ?, ?)', 
                   (user_id, brand, model, description, price))
    conn.commit()
    cursor.execute('SELECT last_insert_rowid()')
    ad_id = cursor.fetchone()[0]
    cursor.close()
    conn.close()
    return ad_id

def photo_question(message):
    Reg_Avto[message.chat.id][4] = message.text
    create_avto(Reg_Avto[message.chat.id][0], Reg_Avto[message.chat.id][1], Reg_Avto[message.chat.id][2], Reg_Avto[message.chat.id][3], Reg_Avto[message.chat.id][4])
    markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
    yes = types.KeyboardButton("âœ…Â  â€¢Â  Ğ¢Ğ°Ğº")
    no = types.KeyboardButton("âŒÂ  â€¢Â  ĞÑ–")
    markup.add(yes, no)
    message = bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ”Ğ¾Ğ´Ğ°Ñ”Ğ¼Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾?", reply_markup=markup)
    bot.register_next_step_handler(message, photo_distribution)

def photo_distribution(message):
    if message.text == "âœ…Â  â€¢Â  Ğ¢Ğ°Ğº":
        message = bot.send_message(message.chat.id, "ğŸ–¼ï¸Â  â€¢Â  Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ñ‚Ğµ Ñ„Ğ¾Ñ‚Ğ¾.")
        bot.register_next_step_handler(message, ad_photo)
    elif message.text == "âŒÂ  â€¢Â  ĞÑ–":
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "ğŸ‰Â  â€¢Â  Ğ’Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾!", reply_markup=markup)
        bot.register_next_step_handler(message, start)

def ad_photo(message):
    ex_counter = 0
    ad_id = check_id(ad_name=Reg_Avto[message.chat.id][1], user_id=Reg_Avto[message.chat.id][0])
    if ad_id is None:
        message = bot.send_message(message.chat.id, "â›”Â  â€¢Â  ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: Ğ½Ğµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ.")
        return

    try:
        Path(f'files/{message.chat.id}/photos').mkdir(parents=True, exist_ok=True)
        file_info = bot.get_file(message.photo[len(message.photo) - 1].file_id)
        downloaded_file = bot.download_file(file_info.file_path)
        src = f'files/{message.chat.id}/' + file_info.file_path
        with open(src, 'wb') as new_file:
            new_file.write(downloaded_file)
    except Exception as e:
        ex_counter = 1
        message = bot.send_message(message.chat.id, f"â›”Â  â€¢Â  Ğ¤Ğ¾Ñ‚Ğ¾ Ğ½Ğµ Ğ¿Ñ–Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ. ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: {e}")
        bot.register_next_step_handler(message, ad_photo)
    
    try:
        with open(src, "rb") as image_file:
            encoded_string = base64.b64encode(image_file.read()).decode('utf-8')
        save_photo(user_id=message.chat.id, ad_id=ad_id, encoded_string=encoded_string)
        shutil.rmtree(f"files/{message.chat.id}")
    except Exception as e:
        ex_counter = 1
        message = bot.send_message(message.chat.id, f"â›”Â  â€¢Â  Ğ¤Ğ¾Ñ‚Ğ¾ Ğ½Ğµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸, Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ñ‚Ğµ Ğ¹Ğ¾Ğ³Ğ¾ Ñ‰Ğµ Ñ€Ğ°Ğ·. ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: {e}")
        bot.register_next_step_handler(message, ad_photo)
    
    if ex_counter == 0:
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "ğŸ‰Â  â€¢Â  Ğ’Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾!", reply_markup=markup)
        bot.register_next_step_handler(message, start)

def save_photo(user_id, ad_id, encoded_string):
    cursor, conn = get_cursor()
    cursor.execute('INSERT INTO photo(user_id, ad_id, picture) VALUES (?, ?, ?)', 
                   (user_id, ad_id, encoded_string))
    conn.commit()
    cursor.close()
    conn.close()

def my_ad_distribution(message):
    if message.text == "ğŸ“Â  â€¢Â  Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸":
        bot.send_message(message.chat.id, "ğŸ“Â  â€¢Â  Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ.")
        my_avto(message.chat.id)
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "â“Â  â€¢Â  ĞĞ°Ğ¿Ğ¸ÑˆÑ–Ñ‚ÑŒ ID Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ, ÑĞºĞµ Ñ‚Ñ€ĞµĞ±Ğ° Ğ²Ñ–Ğ´Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸.", reply_markup=markup)
        bot.register_next_step_handler(message, edit_distribution)

    elif message.text == "ğŸ—‘ï¸Â  â€¢Â  Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸":
        bot.send_message(message.chat.id, "ğŸ—‘ï¸Â  â€¢Â  Ğ’Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ.")
        my_avto(message.chat.id)
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "â“Â  â€¢Â  ĞĞ°Ğ¿Ğ¸ÑˆÑ–Ñ‚ÑŒ ID Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ, ÑĞºĞµ Ñ‚Ñ€ĞµĞ±Ğ° Ğ²Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸.", reply_markup=markup)
        bot.register_next_step_handler(message, delete_question)

    elif message.text == "â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸":
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ Ğ² Ğ¼ĞµĞ½Ñ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸", reply_markup=markup)
        bot.register_next_step_handler(message, start)

def my_avto(id):
    cursor.execute('SELECT * FROM avto')
    rows = cursor.fetchall()
    for row in rows:
        if row[1] == id:
            text = "ğŸš˜Â  â€¢Â  " + str(row[2]) + " " + str(row[3]) + " (ID:" + str(row[0]) + ")" + "\nğŸ’²Â  â€¢Â  " + str(row[5]) + "CR"
            bot.send_message(id, text)

def delete_avto(avto, id):
    cursor.execute('SELECT * FROM avto')
    cursor.execute('DELETE FROM avto WHERE id = ? AND user_id = ?', (avto, id))
    conn.commit()
    try:
        cursor.execute('SELECT * FROM `photo`')
        cursor.execute('DELETE FROM `photo` WHERE `ad_id` = ?', (str(avto)))
        conn.commit()
    except:
        i=1

def delete_question(message):
    if message.text == "â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸":
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        bot.send_message(message.chat.id, "Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ Ğ² Ğ¼ĞµĞ½Ñ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸", reply_markup=markup)
        bot.register_next_step_handler(message, start)
    else:
        avto = message.text
        id = str(message.chat.id)
        delete_avto(avto, id)
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "âœ…Â  â€¢Â  Ğ’Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ¾.", reply_markup=markup)
        bot.register_next_step_handler(message, start)

def edit_distribution(message):
    check = check_is_your(message.text, message.chat.id)
    print(check)
    if check != 1:
        bot.send_message(message.chat.id, "â›”Â  â€¢Â  Ğ¦Ğµ Ğ½Ğµ Ğ²Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ!")
        my_avto(message.chat.id)
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "â“Â  â€¢Â  ĞĞ°Ğ¿Ğ¸ÑˆÑ–Ñ‚ÑŒ ID Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ, ÑĞºĞµ Ñ‚Ñ€ĞµĞ±Ğ° Ğ²Ñ–Ğ´Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸.", reply_markup=markup)
        bot.register_next_step_handler(message, start)
    else:
        Avto[message.chat.id][0] = message.text
        Avto[message.chat.id][1] = message.chat.id
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        brand = types.KeyboardButton("ğŸ·ï¸Â  â€¢Â  Ğ‘Ñ€ĞµĞ½Ğ´")
        model = types.KeyboardButton("ğŸš˜Â  â€¢Â  ĞœĞ¾Ğ´ĞµĞ»ÑŒ")
        price = types.KeyboardButton("ğŸ’²Â  â€¢Â  Ğ¦Ñ–Ğ½Ğ°")
        description = types.KeyboardButton("ğŸ“ƒÂ  â€¢Â  ĞĞ¿Ğ¸Ñ")
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(brand, model, price, description, back_button)
        message = bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ©Ğ¾ ÑĞ°Ğ¼Ğµ Ğ²Ğ¸ Ñ…Ğ¾Ñ‡ĞµÑ‚Ğµ Ğ²Ñ–Ğ´Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸.", reply_markup=markup)
        bot.register_next_step_handler(message, edit)

def edit(message):
    Avto[message.chat.id][2] = parse_brand(Avto[message.chat.id][0])
    Avto[message.chat.id][3] = parse_model(Avto[message.chat.id][0])
    Avto[message.chat.id][4] = parse_description(Avto[message.chat.id][0])
    Avto[message.chat.id][5] = parse_price(Avto[message.chat.id][0])
    if message.text == "ğŸ·ï¸Â  â€¢Â  Ğ‘Ñ€ĞµĞ½Ğ´":
        message = bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ¯ĞºĞ¸Ğ¼ Ñ” Ğ½Ğ¾Ğ²Ğ¸Ğ¹ Ğ±Ñ€ĞµĞ½Ğ´?")
        bot.register_next_step_handler(message, edit_brand)
    elif message.text == "ğŸš˜Â  â€¢Â  ĞœĞ¾Ğ´ĞµĞ»ÑŒ":
        message = bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ¯ĞºĞ¾Ñ Ñ” Ğ½Ğ¾Ğ²Ğ° Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ?")
        bot.register_next_step_handler(message, edit_model)
    elif message.text == "ğŸ’²Â  â€¢Â  Ğ¦Ñ–Ğ½Ğ°":
        message = bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ¯ĞºĞ¾Ñ Ğ±ÑƒĞ´Ğµ Ğ½Ğ¾Ğ²Ğ° Ñ†Ñ–Ğ½Ğ°?")
        bot.register_next_step_handler(message, edit_price)
    elif message.text == "ğŸ“ƒÂ  â€¢Â  ĞĞ¿Ğ¸Ñ":
        message = bot.send_message(message.chat.id, "â“Â  â€¢Â  Ğ¯ĞºĞ¸Ğ¼ Ğ±ÑƒĞ´Ğµ Ğ½Ğ¾Ğ²Ğ¸Ğ¹ Ğ¾Ğ¿Ğ¸Ñ?")
        bot.register_next_step_handler(message, edit_description)
    else:
        markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
        back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
        markup.add(back_button)
        message = bot.send_message(message.chat.id, "Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ²ĞµÑ€Ğ½ĞµĞ½Ğ½Ñ Ğ² Ğ¼ĞµĞ½Ñ Ğ½Ğ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸", reply_markup=markup)
        bot.register_next_step_handler(message, start)

def edit_brand(message):
    Avto[message.chat.id][2] = message.text
    cursor.execute('UPDATE avto SET `brand` = ? WHERE `id` = ?', (message.text, Avto[message.chat.id][0]))
    conn.commit()
    markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
    back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
    markup.add(back_button)
    message = bot.send_message(message.chat.id, "âœ…Â  â€¢Â  Ğ’Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾.", reply_markup=markup)
    bot.register_next_step_handler(message, start)

def edit_model(message):
    Avto[message.chat.id][3] = message.text
    cursor.execute('UPDATE avto SET `model` = ? WHERE `id` = ?', (message.text, Avto[message.chat.id][0]))
    conn.commit()
    markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
    back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
    markup.add(back_button)
    message = bot.send_message(message.chat.id, "âœ…Â  â€¢Â  Ğ’Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾.", reply_markup=markup)
    bot.register_next_step_handler(message, start)

def edit_description(message):
    Avto[message.chat.id][4] = message.text
    cursor.execute("UPDATE avto SET `description` = ? WHERE `id` = ?", (message.text, Avto[message.chat.id][0]))
    conn.commit()
    markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
    back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
    markup.add(back_button)
    message = bot.send_message(message.chat.id, "âœ…Â  â€¢Â  Ğ’Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾.", reply_markup=markup)
    bot.register_next_step_handler(message, start)


def edit_price(message):
    Avto[message.chat.id][5] = message.text
    cursor.execute('UPDATE avto SET `price` =? WHERE `id` = ?', (message.text, Avto[message.chat.id][0]))
    conn.commit()
    markup = types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True)
    back_button = types.KeyboardButton("â†©ï¸Â  â€¢Â  Ğ’Ğ¸Ğ¹Ñ‚Ğ¸")
    markup.add(back_button)
    message = bot.send_message(message.chat.id, "âœ…Â  â€¢Â  Ğ’Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾.", reply_markup=markup)
    bot.register_next_step_handler(message, start)

def parse_brand(id):
    cursor.execute('SELECT * FROM avto')
    rows = cursor.fetchall()
    brand = ""
    for row in rows:
        if row[0] == id:
            brand = row[2]
    return brand

def parse_model(id):
    cursor.execute('SELECT * FROM avto')
    rows = cursor.fetchall()
    name = ""
    for row in rows:
        if row[0] == id:
            name = row[3]
    return name

def parse_description(id):
    cursor.execute('SELECT * FROM avto')
    rows = cursor.fetchall()
    description = ""
    for row in rows:
        if row[0] == id:
            description = row[4]
    return description

def parse_price(id):
    cursor.execute('SELECT * FROM avto')
    rows = cursor.fetchall()
    price = ""
    for row in rows:
        if row[0] == id:
            price = row[5]
    return price

def check_is_your(id, user_id):
    i = 0
    cursor.execute('SELECT * FROM avto')
    rows = cursor.fetchall()
    for row in rows:
        if str(row[0]) == str(id):
            i = 1
        if str(row[1]) == str(user_id):
            break
    return i

def send_answer(avto, user_id):
    cursor.execute('SELECT * FROM avto')
    rows = cursor.fetchall()
    owner_id = 0
    text = "ĞĞ° Ğ²Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ: "
    for row in rows:
        if str(avto) == str(row[0]):
            owner_id = row[1]
            text = text + row[2] + " Ğ’Ñ–Ğ´Ğ³ÑƒĞºĞ½ÑƒĞ»Ğ°ÑÑŒ Ğ»ÑĞ´Ğ¸Ğ½Ğ°:\n"
            break
    cursor.execute('SELECT * FROM user_data')
    users = cursor.fetchall()
    for user in users:
        if user_id == user[0]:
            text = text + str(user[1]) + " " + str(user[2]) + " " + str(user[3]) + " " + str(user[4]) + "\n\n"
            break
    if owner_id != 0:
        bot.send_message(owner_id, text)
        bot.send_message(user_id, "âœ…Â  â€¢Â  ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾, Ğ¾Ñ‡Ñ–ĞºÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾ĞºĞ¸ Ğ· Ğ²Ğ°Ğ¼Ğ¸ Ğ·Ğ²'ÑĞ¶ÑƒÑ‚ÑŒÑÑ.")
    else:
        bot.send_message(user_id, "â›”Â  â€¢Â  ĞĞ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ğ· Ñ‚Ğ°ĞºĞ¸Ğ¼ ID Ğ½ĞµĞ¼Ğ°Ñ”!")

def view_all(user_id):
    cursor.execute('SELECT * FROM avto')
    rows = cursor.fetchall()
    for row in rows:
        text_message = f"<strong>ğŸš˜Â  â€¢Â  {row[2]} {row[3]} (ID: {row[0]})</strong>\n\n<blockquote>{row[4]}</blockquote>\n\n"
        
        cursor.execute('SELECT * FROM photo WHERE ad_id = ?', (row[0],))
        rows_photo = cursor.fetchall()

        text_message += "ğŸ’²Â  â€¢Â  " + str(row[5]) + "CR \n\n"
        
        cursor.execute('SELECT * FROM user_data WHERE id = ?', (row[1],))
        user = cursor.fetchone()
        if user:
            text_message += f'ğŸ‘¤Â  â€¢Â  <a href="https://t.me/{user[4]}">{user[1]} {user[2]}</a>Â  â€¢Â  {user[3]}'

        photo_directory = Path(f'files/search/{user_id}')
        photo_directory.mkdir(parents=True, exist_ok=True)
        
        photos = []
        for idx, photo in enumerate(rows_photo):
            photo_path = photo_directory / f'file_{idx}.jpg'
            with open(photo_path, 'wb') as fh:
                fh.write(base64.decodebytes(photo[2].encode('utf-8')))
            photos.append(InputMediaPhoto(open(photo_path, 'rb')))
        
        if photos:
            photos[0].caption = text_message
            photos[0].parse_mode = 'HTML'
            bot.send_media_group(user_id, media=photos)
            for photo in photos:
                photo.media.close()
        else:
            bot.send_message(user_id, text=text_message, parse_mode='HTML')

        shutil.rmtree(photo_directory)

bot.polling(none_stop=True)
```

Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ”Ğ¼Ğ¾ Ñ„Ğ°Ğ¹Ğ» bot_token.py Ñ‚Ğ° Ğ¿Ğ¸ÑˆĞµĞ¼Ğ¾ ĞºĞ¾Ğ´ Ğ· Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ¼
```python
TOKEN = '7042806378:AAEQ67mWZAOUH5_qMwQDLRpLpdF7TNAF3xc'
```

### Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ¸Ñ…

Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ”Ğ¼Ğ¾ Ñ„Ğ°Ğ¹Ğ» avto.db Ñ‚Ğ° Ğ·Ğ° Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ¾Ñ SQL Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ² ÑÑ‚Ğ²Ğ¾Ñ€ÑÑ”Ğ¼Ğ¾ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ¸Ñ….
```sql
CREATE TABLE avto (id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER REFERENCES user_data (id), brand STRING, model STRING, description TEXT, price STRING);
CREATE TABLE user_data (id INTEGER PRIMARY KEY AUTOINCREMENT UNIQUE, name STRING, surname STRING, phone STRING, tag STRING);
CREATE TABLE photo (user_id INTEGER, ad_id INTEGER, picture BLOB);
```

### ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ”Ğ¼Ğ¾ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñƒ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¸

Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ñ”Ğ¼Ğ¾ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ²Ñ‡Ğ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ñ‚Ğ° Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ´Ğ¾ Ñ‚ĞµÑÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ.
<br>
![1718115164037](image/Ğ—Ğ²Ñ–Ñ‚/1718115164037.png)

ĞŸÑ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ñ€ĞµÑ”ÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ.
<br>
![1718115223283](image/Ğ—Ğ²Ñ–Ñ‚/1718115223283.png)

Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ”Ğ¼Ğ¾ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ.
<br>
![1718115379502](image/Ğ—Ğ²Ñ–Ñ‚/1718115379502.png)

ĞŸÑ€Ğ¾Ğ±ÑƒÑ”Ğ¼Ğ¾ Ğ²Ñ–Ğ´Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ½Ğ°ÑˆĞµ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ Ğ·Ğ° Ğ¼Ğ°Ñ€ĞºĞ¾Ñ.
<br>
![1718115443035](image/Ğ—Ğ²Ñ–Ñ‚/1718115443035.png)

ĞŸÑ€Ğ¾Ğ±ÑƒÑ”Ğ¼Ğ¾ Ğ²Ñ–Ğ´Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸ Ñ†Ñ–Ğ½Ñƒ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ.
<br>
![1718115513199](image/Ğ—Ğ²Ñ–Ñ‚/1718115513199.png)

ĞŸÑ€Ğ¾Ğ±ÑƒÑ”Ğ¼Ğ¾ Ğ²Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸ Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½Ğ½Ñ.
<br>
![1718115565361](image/Ğ—Ğ²Ñ–Ñ‚/1718115565361.png)

Ğ’Ğ¸ĞºĞ¾Ğ½ÑƒÑ”ÑĞ¾ Ğ¿Ğ¾ÑˆÑƒĞº Ğ²ÑÑ–Ñ… Ğ¾Ğ³Ğ¾Ğ»Ğ¾ÑˆĞµĞ½ÑŒ Ñ‚Ğ° Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ”Ğ¼Ğ¾ Ñ‡Ğ¸ Ğ·Ğ½Ğ¸ĞºĞ»Ğ¾ Ğ²Ğ¾Ğ½Ğ¾.
<br>
![1718115622532](image/Ğ—Ğ²Ñ–Ñ‚/1718115622532.png)